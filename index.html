// REPLACE the existing populateAwaitingCustomerJobs function
async function populateAwaitingCustomerJobs() {
    const listContainer = document.getElementById('awaiting-customer-list');
    const noJobsMsg = document.getElementById('no-awaiting-jobs-message');
    listContainer.innerHTML = '';
    noJobsMsg.classList.add('hidden');

    const { data: reports, error } = await sb.from('reports')
        .select(`id, complaint, suggested, vehicles!inner(vehicle_no, vehicle_name, color, vehicle_models(brand, model))`)
        .eq('executive_id', currentUser.id)
        .not('suggested', 'is', null) // Jobs where suggestions have been created
        .is('approved', null) // Jobs where the customer has NOT responded yet
        .order('created_at', { ascending: false });

    if (error) {
        console.error("Error fetching awaiting customer jobs:", error);
        return showError('Could not fetch jobs awaiting a customer response.');
    }

    if (!reports || reports.length === 0) {
        noJobsMsg.classList.remove('hidden');
        return;
    }

    reports.forEach(report => {
        const card = document.createElement('div');
        const vehicle = report.vehicles;
        const brand = vehicle.vehicle_models ? vehicle.vehicle_models.brand : '';
        const model = vehicle.vehicle_models ? vehicle.vehicle_models.model : '';
        const vehicleName = vehicle.vehicle_name || '';
        const color = vehicle.color || '';

        const descriptionParts = [vehicleName, `${brand} ${model}`.trim(), color].filter(part => part);
        const description = descriptionParts.join(' &bull; ');

        card.className = 'p-4 border border-gray-200 rounded-lg hover:shadow-md hover:border-orange-500 cursor-pointer transition-all flex justify-between items-center';
        card.innerHTML = `
            <div class="flex-grow">
                <div class="flex justify-between items-center">
                    <p class="font-bold text-gray-800">${vehicle.vehicle_no}</p>
                    <p class="text-xs text-gray-500 italic">${brand} ${model}</p>
                </div>
                <p class="text-sm text-gray-600 font-semibold mt-1">Awaiting approval on ${JSON.parse(report.suggested || '[]').length} items</p>
            </div>
            <span class="material-symbols-outlined text-gray-400 ml-2">chevron_right</span>
        `;
        card.onclick = () => selectReportForUpdate(report);
        listContainer.appendChild(card);
    });
}
